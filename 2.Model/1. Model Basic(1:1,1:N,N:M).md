# ğŸ“ Django Relationships - Complete Guide

## ğŸ“Š ASCII Relationship Diagrams

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    RELATIONSHIP OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ ONE-TO-ONE (1:1)
   Student â†â”€â”€â”€â”€â”€â”€â†’ StudentProfile
   (One student has exactly one profile)

2ï¸âƒ£ ONE-TO-MANY (1:N)
   Teacher â†â”€â”€â”€â”€â”€â”€â†’ Course
           â”‚        â”œâ”€ Course 1
           â”‚        â”œâ”€ Course 2
           â””â”€â”€â”€â”€â”€â”€â”€â”€â””â”€ Course 3
   (One teacher teaches many courses)

3ï¸âƒ£ MANY-TO-MANY (N:M)
   Student â†â”€â”€â”€â”€â”€â”€â†’ Course
   â”‚                â”‚
   â”œâ”€ Student 1 â”€â”€â”€â†’â”œâ”€ Course A
   â”œâ”€ Student 2 â”€â”€â”€â†’â”œâ”€ Course B
   â””â”€ Student 3 â”€â”€â”€â†’â””â”€ Course C
   (Many students can enroll in many courses)
```

---

## ğŸ—‚ï¸ Complete Example: Student Management System

### **Detailed ASCII Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATABASE RELATIONSHIPS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Teacher    â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)      â”‚
        â”‚ name         â”‚
        â”‚ email        â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 1:N (One teacher â†’ Many courses)
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Course    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Enrollment    â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   N:M   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)      â”‚         â”‚ id (PK)         â”‚
        â”‚ name         â”‚         â”‚ student_id (FK) â”‚
        â”‚ teacher (FK) â”‚         â”‚ course_id (FK)  â”‚
        â”‚ credits      â”‚         â”‚ enrolled_date   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ grade           â”‚
               â†‘                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                          â”‚
               â”‚                          â”‚
               â”‚ N:M                      â”‚
               â”‚ (Many students â†â†’ Many courses)
               â”‚                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
        â”‚   Student    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)      â”‚
        â”‚ name         â”‚
        â”‚ email        â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 1:1 (One student â†’ One profile)
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚StudentProfileâ”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)      â”‚
        â”‚ student (FK) â”‚ â† OneToOneField
        â”‚ phone        â”‚
        â”‚ address      â”‚
        â”‚ date_of_birthâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Models Code

### **models.py**

```python
from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ‘¨â€ğŸ« TEACHER MODEL (Parent in 1:N relationship)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Teacher(models.Model):
    name = models.CharField(max_length=100)
    email = models.EmailField(unique=True)
    department = models.CharField(max_length=100)
    
    def __str__(self):
        return self.name
    
    class Meta:
        db_table = 'teachers'


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ‘¨â€ğŸ“ STUDENT MODEL (Main entity)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Student(models.Model):
    name = models.CharField(max_length=100)
    email = models.EmailField(unique=True)
    enrollment_date = models.DateField(auto_now_add=True)
    
    def __str__(self):
        return self.name
    
    class Meta:
        db_table = 'students'


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“‹ STUDENT PROFILE MODEL (1:1 with Student)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class StudentProfile(models.Model):
    # ğŸ”— ONE-TO-ONE RELATIONSHIP
    student = models.OneToOneField(
        Student,
        on_delete=models.CASCADE,
        related_name='profile'  # Access: student.profile
    )
    
    phone = models.CharField(max_length=15)
    address = models.TextField()
    date_of_birth = models.DateField()
    emergency_contact = models.CharField(max_length=15)
    
    def __str__(self):
        return f"Profile of {self.student.name}"
    
    class Meta:
        db_table = 'student_profiles'


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š COURSE MODEL (Child in 1:N, Parent in N:M)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Course(models.Model):
    name = models.CharField(max_length=100)
    code = models.CharField(max_length=10, unique=True)
    credits = models.IntegerField(validators=[MinValueValidator(1)])
    
    # ğŸ”— ONE-TO-MANY RELATIONSHIP (Many courses â†’ One teacher)
    teacher = models.ForeignKey(
        Teacher,
        on_delete=models.SET_NULL,
        null=True,
        related_name='courses'  # Access: teacher.courses.all()
    )
    
    # ğŸ”— MANY-TO-MANY RELATIONSHIP (via Enrollment)
    students = models.ManyToManyField(
        Student,
        through='Enrollment',  # Custom intermediate table
        related_name='courses'  # Access: student.courses.all()
    )
    
    def __str__(self):
        return f"{self.code} - {self.name}"
    
    class Meta:
        db_table = 'courses'


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“ ENROLLMENT MODEL (N:M Intermediate/Junction Table)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Enrollment(models.Model):
    GRADE_CHOICES = [
        ('A+', 'A+'), ('A', 'A'), ('A-', 'A-'),
        ('B+', 'B+'), ('B', 'B'), ('B-', 'B-'),
        ('C+', 'C+'), ('C', 'C'), ('C-', 'C-'),
        ('D', 'D'), ('F', 'F'), ('I', 'Incomplete'),
    ]
    
    # ğŸ”— MANY-TO-MANY RELATIONSHIPS
    student = models.ForeignKey(
        Student,
        on_delete=models.CASCADE,
        related_name='enrollments'
    )
    
    course = models.ForeignKey(
        Course,
        on_delete=models.CASCADE,
        related_name='enrollments'
    )
    
    # Extra fields in junction table
    enrolled_date = models.DateField(auto_now_add=True)
    grade = models.CharField(max_length=2, choices=GRADE_CHOICES, null=True, blank=True)
    attendance_percentage = models.DecimalField(
        max_digits=5, 
        decimal_places=2, 
        validators=[MinValueValidator(0), MaxValueValidator(100)],
        null=True,
        blank=True
    )
    
    def __str__(self):
        return f"{self.student.name} â†’ {self.course.code}"
    
    class Meta:
        db_table = 'enrollments'
        unique_together = ['student', 'course']  # Prevent duplicate enrollments
```

---

## ğŸ” Relationship Details

### **1ï¸âƒ£ ONE-TO-ONE (1:1)**

```python
# Definition
class StudentProfile(models.Model):
    student = models.OneToOneField(
        Student,
        on_delete=models.CASCADE,
        related_name='profile'
    )
```

**ASCII Flow:**
```
Student (id=1) â†â”€â”€â”€â”€â”€â”€â”€â”€â†’ StudentProfile (id=1, student_id=1)
   John Doe                 Phone: 123-456
                           Address: 123 Main St
```

**Usage:**
```python
# Create
student = Student.objects.create(name="John Doe", email="john@example.com")
profile = StudentProfile.objects.create(
    student=student,
    phone="123-456-7890",
    address="123 Main St",
    date_of_birth="2000-01-01"
)

# Access (Forward)
profile = student.profile  # Get profile from student

# Access (Backward)
student = profile.student  # Get student from profile
```

---

### **2ï¸âƒ£ ONE-TO-MANY (1:N)**

```python
# Definition
class Course(models.Model):
    teacher = models.ForeignKey(
        Teacher,
        on_delete=models.SET_NULL,
        null=True,
        related_name='courses'
    )
```

**ASCII Flow:**
```
Teacher (id=1)
  Dr. Smith
     â”‚
     â”œâ”€â”€â†’ Course (id=1, teacher_id=1) "Python 101"
     â”œâ”€â”€â†’ Course (id=2, teacher_id=1) "Django Advanced"
     â””â”€â”€â†’ Course (id=3, teacher_id=1) "Web Development"
```

**Usage:**
```python
# Create
teacher = Teacher.objects.create(
    name="Dr. Smith",
    email="smith@uni.edu",
    department="Computer Science"
)

course1 = Course.objects.create(
    name="Python 101",
    code="CS101",
    credits=3,
    teacher=teacher
)

course2 = Course.objects.create(
    name="Django Advanced",
    code="CS201",
    credits=4,
    teacher=teacher
)

# Access (Forward: Course â†’ Teacher)
teacher_of_course = course1.teacher

# Access (Backward: Teacher â†’ All Courses)
all_courses = teacher.courses.all()
```

---

### **3ï¸âƒ£ MANY-TO-MANY (N:M)**

```python
# Definition
class Course(models.Model):
    students = models.ManyToManyField(
        Student,
        through='Enrollment',
        related_name='courses'
    )

class Enrollment(models.Model):
    student = models.ForeignKey(Student, ...)
    course = models.ForeignKey(Course, ...)
    grade = models.CharField(...)
```

**ASCII Flow:**
```
Students              Enrollments              Courses
â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€
John (id=1) â”€â”€â”€â”€â”€â†’ (student_id=1, course_id=1) â†â”€â”€â”€â†’ Python 101 (id=1)
            â”€â”€â”€â”€â”€â†’ (student_id=1, course_id=2) â†â”€â”€â”€â†’ Django (id=2)
            
Alice (id=2) â”€â”€â”€â”€â†’ (student_id=2, course_id=1) â†â”€â”€â”€â†’ Python 101 (id=1)
             â”€â”€â”€â”€â†’ (student_id=2, course_id=3) â†â”€â”€â”€â†’ Web Dev (id=3)

Bob (id=3) â”€â”€â”€â”€â”€â”€â†’ (student_id=3, course_id=2) â†â”€â”€â”€â†’ Django (id=2)
           â”€â”€â”€â”€â”€â”€â†’ (student_id=3, course_id=3) â†â”€â”€â”€â†’ Web Dev (id=3)
```

**Usage:**
```python
# Create Students
john = Student.objects.create(name="John Doe", email="john@example.com")
alice = Student.objects.create(name="Alice Smith", email="alice@example.com")

# Create Courses
python_course = Course.objects.create(name="Python 101", code="CS101", credits=3)
django_course = Course.objects.create(name="Django", code="CS201", credits=4)

# Enroll students (creates Enrollment records)
Enrollment.objects.create(
    student=john,
    course=python_course,
    grade='A'
)

Enrollment.objects.create(
    student=john,
    course=django_course,
    grade='B+'
)

Enrollment.objects.create(
    student=alice,
    course=python_course,
    grade='A+'
)

# Access (Forward: Student â†’ Courses)
johns_courses = john.courses.all()

# Access (Backward: Course â†’ Students)
python_students = python_course.students.all()

# Access through intermediate table
johns_enrollments = john.enrollments.all()
for enrollment in johns_enrollments:
    print(f"{enrollment.course.name}: {enrollment.grade}")
```

---

## ğŸ“Š Complete Relationship Summary

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   RELATIONSHIP TYPES                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Relationshipâ”‚ Django Field     â”‚ Example                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1:1         â”‚ OneToOneField    â”‚ Student â†” StudentProfile    â”‚
â”‚ 1:N         â”‚ ForeignKey       â”‚ Teacher â†’ Course            â”‚
â”‚ N:M         â”‚ ManyToManyField  â”‚ Student â†” Course            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Query Examples

### **Example 1: Get all courses taught by a teacher**
```python
teacher = Teacher.objects.get(id=1)
courses = teacher.courses.all()

# With prefetch for optimization
teacher = Teacher.objects.prefetch_related('courses').get(id=1)
```

### **Example 2: Get student's profile**
```python
student = Student.objects.get(id=1)
profile = student.profile  # 1:1 access

# Or with select_related (optimization)
student = Student.objects.select_related('profile').get(id=1)
```

### **Example 3: Get all students in a course**
```python
course = Course.objects.get(code="CS101")
students = course.students.all()

# Get with grades (through Enrollment)
enrollments = course.enrollments.select_related('student').all()
for enrollment in enrollments:
    print(f"{enrollment.student.name}: {enrollment.grade}")
```

### **Example 4: Get all courses for a student**
```python
student = Student.objects.get(id=1)
courses = student.courses.all()

# With enrollment details
enrollments = student.enrollments.select_related('course').all()
for enrollment in enrollments:
    print(f"{enrollment.course.name}: Grade {enrollment.grade}")
```

### **Example 5: Complex query - Students in courses taught by specific teacher**
```python
teacher = Teacher.objects.get(name="Dr. Smith")
students = Student.objects.filter(
    courses__teacher=teacher
).distinct()
```

---

## ğŸ—ƒï¸ Admin Registration

```python
# admin.py
from django.contrib import admin
from .models import Teacher, Student, StudentProfile, Course, Enrollment


@admin.register(Teacher)
class TeacherAdmin(admin.ModelAdmin):
    list_display = ['name', 'email', 'department']


@admin.register(Student)
class StudentAdmin(admin.ModelAdmin):
    list_display = ['name', 'email', 'enrollment_date']


@admin.register(StudentProfile)
class StudentProfileAdmin(admin.ModelAdmin):
    list_display = ['student', 'phone', 'date_of_birth']


@admin.register(Course)
class CourseAdmin(admin.ModelAdmin):
    list_display = ['code', 'name', 'credits', 'teacher']
    list_filter = ['teacher']


@admin.register(Enrollment)
class EnrollmentAdmin(admin.ModelAdmin):
    list_display = ['student', 'course', 'grade', 'enrolled_date']
    list_filter = ['course', 'grade']
```

---

## ğŸš€ Database Migrations

```bash
# Create migrations
python manage.py makemigrations

# Apply migrations
python manage.py migrate

# Create superuser
python manage.py createsuperuser
```

---

## âœ… Key Takeaways

| Relationship | Field | On Model | Access Pattern |
|--------------|-------|----------|----------------|
| **1:1** | `OneToOneField` | Either side | `student.profile` or `profile.student` |
| **1:N** | `ForeignKey` | "Many" side | `course.teacher` (forward)<br>`teacher.courses.all()` (reverse) |
| **N:M** | `ManyToManyField` | Either side | `student.courses.all()`<br>`course.students.all()` |

---

**Perfect! Now you understand all Django relationships! ğŸ‰**
