# ğŸ”„ Laravel to Django ORM Conversion Guide
## With Line-by-Line Comments

Complete conversion from Laravel Eloquent to Django ORM with detailed explanations.

---

## ğŸ“Š Quick Reference Table

| Laravel Eloquent | Django ORM | Relationship Type |
|-----------------|------------|-------------------|
| `hasOne()` | `OneToOneField()` | 1:1 |
| `belongsTo()` | `ForeignKey()` | Reverse 1:1 or N:1 |
| `hasMany()` | `ForeignKey()` (reverse) | 1:N |
| `belongsToMany()` | `ManyToManyField()` | N:M |
| `hasManyThrough()` | Complex query or custom manager | Through relationship |
| `morphTo()` / `morphMany()` | `GenericForeignKey()` / `GenericRelation()` | Polymorphic |
| `morphToMany()` | `GenericForeignKey()` + `ManyToManyField()` | Polymorphic N:M |

---

## 1ï¸âƒ£ One-to-One (1:1)

### **Laravel Code**

```php
// User Model
public function address() {
    return $this->hasOne(Address::class, 'user_id', 'id');
    // hasOne = Define 1:1 relationship
    // Address::class = Related model
    // 'user_id' = Foreign key in Address table
    // 'id' = Primary key in User table
}

// Address Model
public function user() {
    return $this->belongsTo(User::class, 'user_id', 'id');
    // belongsTo = Inverse/reverse of hasOne
    // User::class = Parent model
    // 'user_id' = Foreign key column in this table
    // 'id' = Primary key in User table
}
```

### **Django Equivalent**

```python
# models.py
from django.db import models  # Import Django ORM models module

# User Model (built-in or custom)
class User(models.Model):  # Inherit from Model class
    name = models.CharField(max_length=100)  # String field, max 100 chars
    email = models.EmailField(unique=True)  # Email field with unique constraint
    
    def __str__(self):  # String representation of object
        return self.name  # Return user's name when printed

# Address Model
class Address(models.Model):  # Define Address table/model
    user = models.OneToOneField(  # Define 1:1 relationship field
        User,  # Related model (parent)
        on_delete=models.CASCADE,  # Delete address if user deleted
        related_name='address',  # Access from User: user.address
        primary_key=False  # This is NOT the primary key
    )
    country = models.CharField(max_length=100)  # Country name field
    city = models.CharField(max_length=100)  # City name field
    
    def __str__(self):  # String representation
        return f"{self.user.name}'s address"  # Display with username
```

### **Creating Records**

**Laravel:**
```php
// Method 1: Create address using associate
$user = User::factory()->create();  // Create user using factory
$address = new Address(['country' => 'Malaysia']);  // Create new Address instance
$address->user()->associate($user);  // Associate address with user
$address->save();  // Save to database

// Method 2: Create address directly from user
$user->address()->create(['country' => 'Bangladesh']);  // Create and link in one step
```

**Django:**
```python
# Method 1: Create user then address
user = User.objects.create(  # Create new user record
    name="John",  # Set name
    email="john@example.com"  # Set email
)

address = Address.objects.create(  # Create new address record
    user=user,  # Link to user (foreign key)
    country='Malaysia',  # Set country
    city='Kuala Lumpur'  # Set city
)

# Method 2: Using reverse relation
user.address = Address(  # Create address object
    country='Bangladesh',  # Set country
    city='Dhaka'  # Set city
)
user.address.save()  # Save address to database
```

### **Accessing Relations**

**Laravel:**
```php
// Forward access (Address to User)
$address = $user->address;  // Get address object from user
// Backward access (User from Address)
$user = $address->user;  // Get user object from address
```

**Django:**
```python
# Forward access (User to Address)
address = user.address  # Access related address (no parentheses)

# Backward access (Address to User)
user = address.user  # Access parent user object
```

### **Handling Null Relationships**

**Laravel:**
```php
// Define default values if relationship is null
public function user() {
    return $this->belongsTo(User::class)->withDefault([
        'name' => 'Guest User',  // Default name if user not found
    ]);
}
```

**Django:**
```python
# Method 1: Try-except block
try:
    address = user.address  # Try to get address
except Address.DoesNotExist:  # If address doesn't exist
    address = None  # Set to None

# Method 2: Check existence with hasattr
if hasattr(user, 'address'):  # Check if user has address
    address = user.address  # Get address if exists
else:
    address = None  # Set None if doesn't exist
```

---

## 2ï¸âƒ£ One-to-Many (1:N)

### **Laravel Code**

```php
// User Model
public function posts() {
    return $this->hasMany(Post::class, 'user_id', 'id');
    // hasMany = One user has many posts
    // Post::class = Related model
    // 'user_id' = Foreign key in Post table
    // 'id' = Primary key in User table
}

// Post Model
public function user() {
    return $this->belongsTo(User::class, 'user_id');
    // belongsTo = Many posts belong to one user
    // User::class = Parent model
    // 'user_id' = Foreign key in this table
}
```

### **Django Equivalent**

```python
# models.py

class User(models.Model):  # User table definition
    name = models.CharField(max_length=100)  # User name field
    email = models.EmailField(unique=True)  # Unique email field
    
    def __str__(self):  # String representation
        return self.name  # Return user name

class Post(models.Model):  # Post table definition
    user = models.ForeignKey(  # Foreign key to User (N:1 relationship)
        User,  # Related model (parent)
        on_delete=models.CASCADE,  # Delete posts if user deleted
        related_name='posts'  # Access from User: user.posts.all()
    )
    title = models.CharField(max_length=200)  # Post title field
    content = models.TextField()  # Post content (unlimited text)
    created_at = models.DateTimeField(auto_now_add=True)  # Auto-set on creation
    
    def __str__(self):  # String representation
        return self.title  # Return post title
```

### **Creating Records**

**Laravel:**
```php
// Get existing user
$user = User::find(1);  // Find user by ID
// Create post linked to user
$user->posts()->create([  // Create post through relationship
    'title' => 'New Post Title',  // Set title
    'content' => 'Post content...'  // Set content
]);
```

**Django:**
```python
# Method 1: Create through relationship
user = User.objects.get(id=1)  # Get user by ID
user.posts.create(  # Create post through reverse relation
    title='New Post Title',  # Set title
    content='Post content...'  # Set content
)

# Method 2: Create directly with user
post = Post.objects.create(  # Create post directly
    user=user,  # Set foreign key to user
    title='New Post Title',  # Set title
    content='Post content...'  # Set content
)
```

### **Retrieving Records**

**Laravel:**
```php
// Get all posts for a user
$posts = User::find(1)->posts;  // Access posts collection
// Get only titles as array
$postTitles = $user->posts->pluck('title')->toArray();  // Extract titles
```

**Django:**
```python
# Get all posts for a user
posts = User.objects.get(id=1).posts.all()  # Get all related posts

# Method 1: Get list of titles using values_list
post_titles = user.posts.values_list('title', flat=True)  # Returns flat list

# Method 2: Get titles using list comprehension
post_titles = [post.title for post in user.posts.all()]  # Loop and extract
```

---

## 3ï¸âƒ£ Many-to-Many (N:M)

### **Laravel Code**

```php
// Post Model
public function tags() {
    return $this->belongsToMany(Tag::class, 'post_tag', 'post_id', 'tag_id');
    // belongsToMany = Many-to-many relationship
    // Tag::class = Related model
    // 'post_tag' = Junction/pivot table name
    // 'post_id' = Foreign key for this model
    // 'tag_id' = Foreign key for related model
}

// Tag Model
public function posts() {
    return $this->belongsToMany(Post::class, 'post_tag', 'tag_id', 'post_id');
    // belongsToMany = Reverse many-to-many
    // Post::class = Related model
    // 'post_tag' = Junction/pivot table name
    // 'tag_id' = Foreign key for this model
    // 'post_id' = Foreign key for related model
}
```

### **Django Equivalent**

```python
# models.py

class Tag(models.Model):  # Tag table definition
    name = models.CharField(max_length=50, unique=True)  # Unique tag name
    
    def __str__(self):  # String representation
        return self.name  # Return tag name

class Post(models.Model):  # Post table definition
    user = models.ForeignKey(  # Link to User
        User,  # User model
        on_delete=models.CASCADE,  # Delete posts if user deleted
        related_name='posts'  # Reverse access name
    )
    title = models.CharField(max_length=200)  # Post title
    content = models.TextField()  # Post content
    tags = models.ManyToManyField(  # Many-to-many relationship
        Tag,  # Related model
        related_name='posts',  # Reverse access: tag.posts.all()
        db_table='post_tag'  # Optional: custom junction table name
    )
    
    def __str__(self):  # String representation
        return self.title  # Return post title
```

**ASCII Diagram:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Post   â”‚    â”‚   post_tag   â”‚    â”‚    Tag    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id       â”‚â—„â”€â”€â”€â”¤ post_id      â”‚â”€â”€â”€â–ºâ”‚ id        â”‚
â”‚ title    â”‚    â”‚ tag_id       â”‚    â”‚ name      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Working with Many-to-Many**

**Laravel:**
```php
$post = Post::find(1);  // Get post by ID

// Attach tags to post
$post->tags()->attach([1, 2, 3]);  // Link tags with IDs 1, 2, 3

// Detach specific tags
$post->tags()->detach([2]);  // Remove tag with ID 2
// Detach all tags
$post->tags()->detach();  // Remove all tag relationships

// Sync tags (remove existing, add new)
$post->tags()->sync([1, 3, 4]);  // Keep only tags 1, 3, 4
```

**Django:**
```python
post = Post.objects.get(id=1)  # Get post by ID

# Add tags to post
post.tags.add(1, 2, 3)  # Add tags with IDs 1, 2, 3
# Or with tag objects
tag1 = Tag.objects.get(id=1)  # Get tag object
post.tags.add(tag1)  # Add tag object

# Remove specific tags
post.tags.remove(2)  # Remove tag with ID 2
# Or remove all tags
post.tags.clear()  # Remove all tag relationships

# Set tags (similar to sync - replaces all)
post.tags.set([1, 3, 4])  # Replace all tags with IDs 1, 3, 4
```

---

## 4ï¸âƒ£ Many-to-Many with Pivot/Through Table

### **Laravel Code**

```php
// Migration for pivot table
Schema::create('post_tag', function (Blueprint $table) {
    $table->bigInteger('post_id');  // Foreign key to posts table
    $table->bigInteger('tag_id');  // Foreign key to tags table
    $table->string('status')->nullable();  // Extra column for status
    $table->timestamps();  // created_at and updated_at columns
});

// Post Model with pivot columns
public function tags() {
    return $this->belongsToMany(Tag::class)  // Define many-to-many
                ->withPivot('status')  // Access extra pivot column
                ->withTimestamps();  // Include timestamp columns
}
```

### **Django Equivalent**

```python
# models.py

class PostTag(models.Model):  # Custom through/junction table model
    """Custom through model for Post-Tag relationship"""
    post = models.ForeignKey(  # Foreign key to Post
        Post,  # Post model
        on_delete=models.CASCADE  # Delete if post deleted
    )
    tag = models.ForeignKey(  # Foreign key to Tag
        Tag,  # Tag model
        on_delete=models.CASCADE  # Delete if tag deleted
    )
    status = models.CharField(  # Extra field for status
        max_length=50,  # Max 50 characters
        null=True,  # Can be NULL
        blank=True  # Can be empty in forms
    )
    created_at = models.DateTimeField(auto_now_add=True)  # Auto-set on creation
    updated_at = models.DateTimeField(auto_now=True)  # Auto-update on save
    
    class Meta:  # Model metadata
        db_table = 'post_tag'  # Custom table name
        unique_together = ['post', 'tag']  # Prevent duplicate relationships
    
    def __str__(self):  # String representation
        return f"{self.post.title} - {self.tag.name}"  # Display relationship

class Post(models.Model):  # Post model definition
    title = models.CharField(max_length=200)  # Post title
    content = models.TextField()  # Post content
    tags = models.ManyToManyField(  # Many-to-many with custom through
        Tag,  # Related model
        through='PostTag',  # Use custom through model
        related_name='posts'  # Reverse access name
    )
```

### **Working with Through Table**

**Laravel:**
```php
// Setting extra values when attaching
$post->tags()->attach([
    1 => ['status' => 'approved']  // Attach tag ID 1 with status
]);

// Accessing pivot data
foreach ($post->tags as $tag) {  // Loop through tags
    echo $tag->pivot->status;  // Access pivot status field
}
```

**Django:**
```python
# Method 1: Create through model directly
PostTag.objects.create(  # Create junction record
    post=post,  # Link to post
    tag=tag,  # Link to tag
    status='approved'  # Set extra field
)

# Method 2: Accessing through data (simple)
for tag in post.tags.all():  # Loop through tags
    post_tag = PostTag.objects.get(post=post, tag=tag)  # Get junction record
    print(post_tag.status)  # Print status

# Method 3: Better way with prefetch (optimization)
post = Post.objects.prefetch_related('posttag_set').get(id=1)  # Prefetch junction records
for post_tag in post.posttag_set.all():  # Loop through junction records
    print(f"{post_tag.tag.name}: {post_tag.status}")  # Print tag and status
```

---

## 5ï¸âƒ£ Has-Many-Through

### **Laravel Code**

```php
// Project Model
public function tasks() {
    return $this->hasManyThrough(
        Task::class,      // Final model we want to access
        User::class,      // Intermediate model
        'project_id',     // Foreign key on intermediate (User) table
        'user_id',        // Foreign key on final (Task) table
        'id',             // Primary key on current (Project) table
        'id'              // Primary key on intermediate (User) table
    );
}
```

**Diagram:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Project â”‚     â”‚   User   â”‚     â”‚   Task    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id       â”‚â”€â”€â”€â”€â–ºâ”‚ project_id    â”‚     user_idâ”‚â—„â”€â”€â”€â”
â”‚ title    â”‚  1:Nâ”‚ name     â”‚  1:Nâ”‚ title     â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
      â”‚                                             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Django Equivalent**

Django doesn't have direct `hasManyThrough`, but achieves it with queries:

```python
# models.py

class Project(models.Model):  # Project table
    title = models.CharField(max_length=200)  # Project title
    
    def get_tasks(self):  # Custom method to get tasks
        """Get all tasks through users"""
        return Task.objects.filter(user__project=self)  # Filter tasks by project
        # user__project follows relationship: Task -> User -> Project
    
    def __str__(self):  # String representation
        return self.title  # Return project title

class User(models.Model):  # User table (intermediate)
    name = models.CharField(max_length=100)  # User name
    project = models.ForeignKey(  # Link to project
        Project,  # Project model
        on_delete=models.CASCADE,  # Delete users if project deleted
        related_name='users'  # Reverse access: project.users.all()
    )

class Task(models.Model):  # Task table (final model)
    title = models.CharField(max_length=200)  # Task title
    user = models.ForeignKey(  # Link to user
        User,  # User model
        on_delete=models.CASCADE,  # Delete tasks if user deleted
        related_name='tasks'  # Reverse access: user.tasks.all()
    )
```

### **Usage**

**Laravel:**
```php
$project = Project::find(1);  // Get project by ID
$tasks = $project->tasks;  // Access tasks through relationship
```

**Django:**
```python
project = Project.objects.get(id=1)  # Get project by ID

# Method 1: Using custom method
tasks = project.get_tasks()  # Call custom method

# Method 2: Direct query with __ (double underscore)
tasks = Task.objects.filter(user__project=project)  # Filter through relationships
# user__project means: follow user FK, then project FK

# Method 3: Loop through intermediate
tasks = []  # Initialize empty list
for user in project.users.all():  # Loop through project users
    tasks.extend(user.tasks.all())  # Add user's tasks to list
```

---

## 6ï¸âƒ£ Polymorphic Relationships (Generic Relations)

### **Laravel Code**

```php
// Comment Migration
Schema::create('comments', function (Blueprint $table) {
    $table->id();  // Primary key
    $table->bigInteger('user_id');  // Foreign key to user
    $table->text('body');  // Comment text
    $table->morphs('commentable');  // Creates commentable_id and commentable_type
    // commentable_id = ID of parent (Post ID or Video ID)
    // commentable_type = Class name of parent (Post or Video)
    $table->timestamps();  // created_at and updated_at
});

// Comment Model
public function commentable() {
    return $this->morphTo();  // Define polymorphic relationship
    // Returns Post or Video instance based on commentable_type
}

// Post Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable');
    // morphMany = One Post has many Comments
    // Comment::class = Related model
    // 'commentable' = Name of polymorphic relationship
}

// Video Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable');
    // morphMany = One Video has many Comments
    // Comment::class = Related model
    // 'commentable' = Name of polymorphic relationship
}
```

### **Django Equivalent**

```python
# models.py
from django.contrib.contenttypes.fields import GenericForeignKey, GenericRelation  # Import generic relation fields
from django.contrib.contenttypes.models import ContentType  # Import content type model

class Comment(models.Model):  # Comment table
    user = models.ForeignKey(  # Link to user
        User,  # User model
        on_delete=models.CASCADE  # Delete comment if user deleted
    )
    body = models.TextField()  # Comment text
    
    # Polymorphic fields (3 fields needed)
    content_type = models.ForeignKey(  # Stores model type (Post/Video)
        ContentType,  # ContentType model
        on_delete=models.CASCADE  # Delete if content type deleted
    )
    object_id = models.PositiveIntegerField()  # Stores ID of parent object
    commentable = GenericForeignKey('content_type', 'object_id')  # Combines above two fields
    # GenericForeignKey = Virtual field that returns actual parent object
    
    created_at = models.DateTimeField(auto_now_add=True)  # Auto-set on creation
    
    def __str__(self):  # String representation
        return f"Comment by {self.user.name}"  # Display with username

class Post(models.Model):  # Post table
    title = models.CharField(max_length=200)  # Post title
    content = models.TextField()  # Post content
    
    # Reverse generic relation
    comments = GenericRelation(Comment)  # Access comments: post.comments.all()
    # GenericRelation = Allows reverse access from Post to Comments
    
    def __str__(self):  # String representation
        return self.title  # Return title

class Video(models.Model):  # Video table
    title = models.CharField(max_length=200)  # Video title
    url = models.URLField()  # Video URL
    
    # Reverse generic relation
    comments = GenericRelation(Comment)  # Access comments: video.comments.all()
    # GenericRelation = Allows reverse access from Video to Comments
    
    def __str__(self):  # String representation
        return self.title  # Return title
```

**Diagram:**
```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    Comment    â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ id            â”‚
          â”‚ user_id       â”‚
          â”‚ body          â”‚
          â”‚ content_type_id   â”‚  (Stores: "post" or "video")
          â”‚ object_id     â”‚  (Stores: Post ID or Video ID)
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–²     â–²
             â”‚     â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                             â”‚
â”Œâ”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚   Post    â”‚          â”‚   Video    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id        â”‚          â”‚ id         â”‚
â”‚ title     â”‚          â”‚ title      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Usage**

**Laravel:**
```php
// Create comment on post
$post = Post::find(1);  // Get post by ID
$post->comments()->create([  // Create comment through relationship
    'user_id' => 1,  // Set user ID
    'body' => 'A comment on a post'  // Set comment text
]);

// Create comment on video
$video = Video::find(1);  // Get video by ID
$video->comments()->create([  // Create comment through relationship
    'user_id' => 1,  // Set user ID
    'body' => 'A comment on a video'  // Set comment text
]);

// Getting the parent model from a comment
$comment = Comment::find(1);  // Get comment by ID
$commentable = $comment->commentable;  // Returns Post or Video instance
```

**Django:**
```python
from django.contrib.contenttypes.models import ContentType  # Import ContentType

# Method 1: Create comment on post using commentable field
post = Post.objects.get(id=1)  # Get post by ID
Comment.objects.create(  # Create new comment
    user=user,  # Set user
    body='Comment on post',  # Set text
    commentable=post  # Set parent (auto-sets content_type and object_id)
)

# Method 2: Using reverse relation (easier)
post.comments.create(  # Create through reverse relation
    user=user,  # Set user
    body='Comment on post'  # Set text
)

# Create comment on video
video = Video.objects.get(id=1)  # Get video by ID
video.comments.create(  # Create through reverse relation
    user=user,  # Set user
    body='Comment on video'  # Set text
)

# Access parent object from comment
comment = Comment.objects.get(id=1)  # Get comment by ID
commentable = comment.commentable  # Returns Post or Video instance

# Get all comments for a post
post_comments = post.comments.all()  # Get all related comments
```

### **Setup Required**

Add to `settings.py`:
```python
INSTALLED_APPS = [
    'django.contrib.contenttypes',  # Required for GenericForeignKey
    # Make sure this app is in INSTALLED_APPS
    # ...
]
```

---

## 7ï¸âƒ£ Many-to-Many Polymorphic

### **Laravel Code**

```php
// Taggables Migration (junction table)
Schema::create('taggables', function (Blueprint $table) {
    $table->bigInteger('tag_id');  // Foreign key to tags table
    $table->bigInteger('taggable_id');  // ID of parent (Post/Video)
    $table->string('taggable_type');  // Type of parent (Post/Video)
});

// Tag Model
public function posts() {
    return $this->morphedByMany(Post::class, 'taggable');
    // morphedByMany = Reverse polymorphic many-to-many
    // Post::class = Related model
    // 'taggable' = Name of polymorphic relation
}

public function videos() {
    return $this->morphedByMany(Video::class, 'taggable');
    // morphedByMany = Reverse polymorphic many-to-many
    // Video::class = Related model
    // 'taggable' = Name of polymorphic relation
}

// Post Model
public function tags() {
    return $this->morphToMany(Tag::class, 'taggable');
    // morphToMany = Polymorphic many-to-many
    // Tag::class = Related model
    // 'taggable' = Name of polymorphic relation
}

// Video Model
public function tags() {
    return $this->morphToMany(Tag::class, 'taggable');
    // morphToMany = Polymorphic many-to-many
    // Tag::class = Related model
    // 'taggable' = Name of polymorphic relation
}
```

### **Django Equivalent**

```python
# models.py
from django.contrib.contenttypes.fields import GenericForeignKey  # Import generic FK
from django.contrib.contenttypes.models import ContentType  # Import ContentType model

class Tag(models.Model):  # Tag table
    name = models.CharField(max_length=50, unique=True)  # Unique tag name
    
    def __str__(self):  # String representation
        return self.name  # Return tag name
    
    def get_posts(self):  # Custom method to get posts
        """Get all posts with this tag"""
        post_ct = ContentType.objects.get_for_model(Post)  # Get ContentType for Post
        taggable_ids = Taggable.objects.filter(  # Filter junction records
            tag=self,  # Where tag is this tag
            content_type=post_ct  # And type is Post
        ).values_list('object_id', flat=True)  # Get list of post IDs
        return Post.objects.filter(id__in=taggable_ids)  # Return posts with these IDs
    
    def get_videos(self):  # Custom method to get videos
        """Get all videos with this tag"""
        video_ct = ContentType.objects.get_for_model(Video)  # Get ContentType for Video
        taggable_ids = Taggable.objects.filter(  # Filter junction records
            tag=self,  # Where tag is this tag
            content_type=video_ct  # And type is Video
        ).values_list('object_id', flat=True)  # Get list of video IDs
        return Video.objects.filter(id__in=taggable_ids)  # Return videos with these IDs

class Taggable(models.Model):  # Junction table for polymorphic M:N
    """Junction table for polymorphic many-to-many"""
    tag = models.ForeignKey(  # Link to tag
        Tag,  # Tag model
        on_delete=models.CASCADE  # Delete if tag deleted
    )
    content_type = models.ForeignKey(  # Type of parent (Post/Video)
        ContentType,  # ContentType model
        on_delete=models.CASCADE  # Delete if content type deleted
    )
    object_id = models.PositiveIntegerField()  # ID of parent object
    content_object = GenericForeignKey('content_type', 'object_id')  # Virtual field to parent
    # GenericForeignKey = Combines content_type and object_id to get actual object
    
    class Meta:  # Model metadata
        unique_together = ['tag', 'content_type', 'object_id']  # Prevent duplicates
    
    def __str__(self):  # String representation
        return f"{self.tag.name} on {self.content_type.model}"  # Display tag and type

class Post(models.Model):  # Post table
    title = models.CharField(max_length=200)  # Post title
    
    def get_tags(self):  # Custom method to get tags
        """Get all tags for this post"""
        post_ct = ContentType.objects.get_for_model(Post)  # Get ContentType for Post
        tag_ids = Taggable.objects.filter(  # Filter junction records
            content_type=post_ct,  # Where type is Post
            object_id=self.id  # And object is this post
        ).values_list('tag_id', flat=True)  # Get list of tag IDs
        return Tag.objects.filter(id__in=tag_ids)  # Return tags with these IDs
    
    def add_tag(self, tag):  # Custom method to add tag
        """Add a tag to this post"""
        Taggable.objects.get_or_create(  # Create if not exists
            tag=tag,  # Set tag
            content_type=ContentType.objects.get_for_model(Post),  # Set type to Post
            object_id=self.id  # Set ID to this post's ID
        )

class Video(models.Model):  # Video table
    title = models.CharField(max_length=200)  # Video title
    
    def get_tags(self):  # Custom method to get tags
        """Get all tags for this video"""
        video_ct = ContentType.objects.get_for_model(Video)  # Get ContentType for Video
        tag_ids = Taggable.objects.filter(  # Filter junction records
            content_type=video_ct,  # Where type is Video
            object_id=self.id  # And object is this video
        ).values_list('tag_id', flat=True)  # Get list of tag IDs
        return Tag.objects.filter(id__in=tag_ids)  # Return tags with these IDs
    
    def add_tag(self, tag):  # Custom method to add tag
        """Add a tag to this video"""
        Taggable.objects.get_or_create(  # Create if not exists
            tag=tag,  # Set tag
            content_type=ContentType.objects.get_for_model(Video),  # Set type to Video
            object_id=self.id  # Set ID to this video's ID
        )
```

### **Usage**

**Laravel:**
```php
// Create and attach tag to post
$post = Post::find(1);  // Get post by ID
$post->tags()->create(['name' => 'Laravel']);  // Create and attach tag

// Get all posts with a tag
$tag = Tag::find(1);  // Get tag by ID
$posts = $tag->posts;  // Get all posts with this tag
$videos = $tag->videos;  // Get all videos with this tag
```

**Django:**
```python
# Create and attach tag to post
post = Post.objects.get(id=1)  # Get post by ID
tag = Tag.objects.create(name='Django')  # Create new tag
post.add_tag(tag)  # Add tag to post using custom method

# Or manually create junction record
Taggable.objects.create(  # Create junction record
    tag=tag,  # Link to tag
    content_object=post  # Link to post (sets content_type and object_id)
)

# Get all tags for a post
tags = post.get_tags()  # Use custom method

# Get all posts with a tag
tag = Tag.objects.get(name='Django')  # Get tag by name
posts = tag.get_posts()  # Get posts using custom method
videos = tag.get_videos()  # Get videos using custom method
```

---

## 8ï¸âƒ£ Query Optimization

### **Eager Loading (N+1 Problem)**

**Laravel:**
```php
// Without eager loading (N+1 problem)
$posts = Post::all();  // 1 query to get all posts
foreach ($posts as $post) {
    echo $post->user->name;  // N queries (one per post)
    // Total: 1 + N queries
}

// With eager loading (solves N+1)
$posts = Post::with('user')->get();  // 2 queries total (posts + users)
foreach ($posts as $post) {
    echo $post->user->name;  // No additional queries
    // Total: 2 queries only
}
```

**Django:**
```python
# Without optimization (N+1 problem)
posts = Post.objects.all()  # 1 query for posts
for post in posts:
    print(post.user.name)  # N queries (one per post)
    # Total: 1 + N queries

# With select_related (for ForeignKey/OneToOne)
posts = Post.objects.select_related('user').all()  # 1 query with JOIN
# select_related = Uses SQL JOIN to get related data in single query
for post in posts:
    print(post.user.name)  # No additional queries
    # Total: 1 query only

# With prefetch_related (for ManyToMany/Reverse FK)
posts = Post.objects.prefetch_related('tags').all()  # 2 queries (posts + tags)
# prefetch_related = Separate query for related objects, then combines in Python
for post in posts:
    for tag in post.tags.all():  # No additional queries
        print(tag.name)

# Multiple relationships
posts = Post.objects.select_related('user').prefetch_related('tags').all()
# select_related for ForeignKey, prefetch_related for ManyToMany
```

### **Query with Conditions**

**Laravel:**
```php
// Filter users who have posts
$users = User::has('posts')->get();  // Get users with at least 1 post

// Filter users who have at least 2 posts
$users = User::has('posts', '>=', 2)->get();  // Get users with 2+ posts

// Filter with custom conditions
$users = User::whereHas('posts', function ($query) {  // Custom filter
    $query->where('title', 'like', '%Laravel%');  // Posts with 'Laravel' in title
})->get();

// Filter users who don't have any posts
$users = User::doesntHave('posts')->get();  // Get users with 0 posts
```

**Django:**
```python
# Users who have posts
users = User.objects.filter(posts__isnull=False).distinct()
# posts__isnull=False = Has at least one post
# distinct() = Remove duplicates

# Users with specific post conditions
users = User.objects.filter(
    posts__title__icontains='Django'  # Posts with 'Django' in title
).distinct()  # Remove duplicates
# __icontains = Case-insensitive contains

# Users without posts
users = User.objects.filter(posts__isnull=True)
# posts__isnull=True = Has no posts

# Count posts (with annotation)
from django.db.models import Count  # Import Count aggregation
users = User.objects.annotate(  # Add calculated field
    post_count=Count('posts')  # Count related posts
).filter(post_count__gte=2)  # Filter users with 2+ posts
# annotate = Add computed field to queryset
# Count('posts') = Count number of related posts
```

### **Selecting Specific Columns**

**Laravel:**
```php
// Select only specific columns
$users = User::select('id', 'name')->get();  // Only get id and name columns

// With relationships
$posts = Post::select('id', 'title')  // Select post columns
            ->with(['user' => function ($query) {  // Eager load user
                $query->select('id', 'name');  // Select only user id and name
            }])
            ->get();
```

**Django:**
```python
# Method 1: only() - Load only specific fields
users = User.objects.only('id', 'name')  # Load only id and name
# only() = Load specified fields, others are deferred

# Method 2: values() - Returns dictionary instead of model instance
users = User.objects.values('id', 'name')  # Returns list of dicts
# values() = Returns dict, not model objects

# Method 3: values_list() - Returns tuple
users = User.objects.values_list('id', 'name')  # Returns list of tuples
# values_list() = Returns tuples instead of dicts

# With relationships
posts = Post.objects.select_related('user').only(  # Eager load user
    'id', 'title',  # Post fields
    'user__id', 'user__name'  # User fields (use __ to access related)
)
# user__id = Access user's id through relationship
```

---

## 9ï¸âƒ£ Model Events

### **Laravel**

```php
// In your model class
protected static function boot() {  // Override boot method
    parent::boot();  // Call parent boot
    
    static::created(function ($model) {  // After model created
        // This runs after a new record is inserted
        Log::info('Model created: ' . $model->id);
    });
    
    static::updated(function ($model) {  // After model updated
        // This runs after a record is updated
        Log::info('Model updated: ' . $model->id);
    });
    
    static::deleted(function ($model) {  // After model deleted
        // This runs after a record is deleted
        Log::info('Model deleted: ' . $model->id);
    });
    
    static::saved(function ($model) {  // After created OR updated
        // This runs after create or update
        Log::info('Model saved: ' . $model->id);
    });
}
```

### **Django**

```python
# Method 1: Using Django signals
from django.db.models.signals import post_save, post_delete, pre_save  # Import signals
from django.dispatch import receiver  # Import receiver decorator

# After save (create or update)
@receiver(post_save, sender=Post)  # Decorator to connect signal
# post_save = Signal sent after save() is called
# sender=Post = Only listen to Post model
def post_created(sender, instance, created, **kwargs):  # Signal handler function
    # sender = Model class (Post)
    # instance = Actual model instance that was saved
    # created = True if new record, False if updated
    # **kwargs = Additional arguments
    if created:  # Check if newly created
        print(f"New post created: {instance.title}")  # Log creation
    else:
        print(f"Post updated: {instance.title}")  # Log update

# Before save
@receiver(pre_save, sender=Post)  # Before save signal
# pre_save = Signal sent before save() is called
def post_before_save(sender, instance, **kwargs):  # Handler function
    print(f"About to save: {instance.title}")  # Log before save

# After delete
@receiver(post_delete, sender=Post)  # After delete signal
# post_delete = Signal sent after delete() is called
def post_deleted(sender, instance, **kwargs):  # Handler function
    print(f"Post deleted: {instance.title}")  # Log deletion

# Method 2: Override save method in model
class Post(models.Model):  # Model definition
    title = models.CharField(max_length=200)  # Title field
    
    def save(self, *args, **kwargs):  # Override save method
        # *args, **kwargs = Accept any arguments passed to save()
        
        # Before save logic
        print(f"Saving post: {self.title}")  # Log before save
        
        # Call original save method
        super().save(*args, **kwargs)  # Actually save to database
        # super() = Call parent class method
        
        # After save logic
        print(f"Post saved!")  # Log after save
        # This code runs after record is in database
```

---

## ğŸ”Ÿ Complete Comparison Summary

| Feature | Laravel | Django | Notes |
|---------|---------|--------|-------|
| **1:1** | `hasOne()` / `belongsTo()` | `OneToOneField()` | Define on either side |
| **1:N** | `hasMany()` / `belongsTo()` | `ForeignKey()` with `related_name` | ForeignKey on "many" side |
| **N:M** | `belongsToMany()` | `ManyToManyField()` | Can define on either side |
| **Through** | `withPivot()` | `through='Model'` | Extra fields in junction |
| **Polymorphic** | `morphTo()` / `morphMany()` | `GenericForeignKey()` / `GenericRelation()` | Requires contenttypes app |
| **Eager Load** | `with()` | `select_related()` / `prefetch_related()` | Prevents N+1 queries |
| **Create** | `create()` | `create()` | Create and save in one step |
| **Attach** | `attach()` | `add()` | Add M:N relationship |
| **Detach** | `detach()` | `remove()` / `clear()` | Remove M:N relationship |
| **Sync** | `sync()` | `set()` | Replace all M:N relationships |
| **Events** | `boot()` method | Signals or override `save()` | Lifecycle hooks |

---

## ğŸ“ Complete Django Example with Comments

```python
# models.py
from django.db import models  # Import Django ORM
from django.contrib.contenttypes.fields import GenericForeignKey, GenericRelation  # Import generic fields
from django.contrib.contenttypes.models import ContentType  # Import ContentType

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# USER MODEL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class User(models.Model):  # Define User table
    name = models.CharField(max_length=100)  # User name, max 100 chars
    email = models.EmailField(unique=True)  # Unique email address

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ADDRESS MODEL (1:1 with User)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Address(models.Model):  # Define Address table
    user = models.OneToOneField(  # One-to-one with User
        User,  # Link to User model
        on_delete=models.CASCADE,  # Delete address when user deleted
        related_name='address'  # Access: user.address
    )
    country = models.CharField(max_length=100)  # Country name

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# POST MODEL (N:1 with User, N:M with Tag)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Post(models.Model):  # Define Post table
    user = models.ForeignKey(  # Many posts to one user
        User,  # Link to User model
        on_delete=models.CASCADE,  # Delete posts when user deleted
        related_name='posts'  # Access: user.posts.all()
    )
    title = models.CharField(max_length=200)  # Post title
    tags = models.ManyToManyField(  # Many-to-many with Tag
        'Tag',  # Link to Tag model (string since defined below)
        through='PostTag',  # Use custom junction table
        related_name='posts'  # Access: tag.posts.all()
    )
    comments = GenericRelation('Comment')  # Polymorphic reverse relation

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TAG MODEL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Tag(models.Model):  # Define Tag table
    name = models.CharField(max_length=50, unique=True)  # Unique tag name

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# POST-TAG JUNCTION TABLE (Through model)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class PostTag(models.Model):  # Custom junction table
    post = models.ForeignKey(  # Link to Post
        Post,  # Post model
        on_delete=models.CASCADE  # Delete when post deleted
    )
    tag = models.ForeignKey(  # Link to Tag
        Tag,  # Tag model
        on_delete=models.CASCADE  # Delete when tag deleted
    )
    status = models.CharField(  # Extra field
        max_length=50,  # Max 50 characters
        null=True  # Can be NULL
    )
    created_at = models.DateTimeField(auto_now_add=True)  # Auto timestamp

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# COMMENT MODEL (Polymorphic - can belong to Post/Video)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Comment(models.Model):  # Define Comment table
    user = models.ForeignKey(  # Link to user who commented
        User,  # User model
        on_delete=models.CASCADE  # Delete comments when user deleted
    )
    body = models.TextField()  # Comment text
    content_type = models.ForeignKey(  # Type of parent (Post/Video)
        ContentType,  # ContentType model
        on_delete=models.CASCADE  # Delete when content type deleted
    )
    object_id = models.PositiveIntegerField()  # ID of parent
    commentable = GenericForeignKey('content_type', 'object_id')  # Virtual parent field
```

---

**âœ… Complete Guide with Line-by-Line Comments!** ğŸ‰  
Now every line is explained for easy understanding and conversion between Laravel and Django!
